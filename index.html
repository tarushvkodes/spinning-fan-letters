<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Blender Fan with 3 Blades Following Mouse</title>
  <style>
    body { margin: 0; overflow: hidden; background: #222; }
    canvas { display: block; }
  </style>
</head>
<body>
  <canvas id="canvas"></canvas>
  
  <!-- Matter.js physics engine and poly-decomp (for concave bodies if needed) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/matter-js/0.19.0/matter.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/poly-decomp/0.3.0/decomp.min.js"></script>
  
  <script>
    document.addEventListener("DOMContentLoaded", function() {
      // Alias Matter.js modules.
      const Engine = Matter.Engine,
            World  = Matter.World,
            Bodies = Matter.Bodies,
            Body   = Matter.Body,
            Common = Matter.Common;
      
      // Create the physics engine and world.
      const engine = Engine.create();
      const world  = engine.world;
      world.gravity.y = 1;  // Moderate gravity
      
      // Get the canvas and its context.
      const canvas = document.getElementById("canvas");
      const ctx = canvas.getContext("2d");
      
      // Resize canvas to fill the window.
      function resizeCanvas() {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
      }
      window.addEventListener("resize", resizeCanvas);
      resizeCanvas();
      
      // --- Ground ---
      // Create a static ground at the bottom.
      const ground = Bodies.rectangle(canvas.width / 2, canvas.height - 20, canvas.width, 40, { 
        isStatic: true,
        render: { fillStyle: "#888" }
      });
      World.add(world, ground);
      
      // --- Blender Fan Setup ---
      // Create a fan shape with three blades.
      // We'll make a 3-blade fan by constructing a 6-vertex star.
      const outerRadius = 100;
      const innerRadius = 40;
      const numPoints = 6;  // Alternating outer and inner points give 3 distinct blades.
      let fanVertices = [];
      for (let i = 0; i < numPoints; i++) {
        // Calculate angle for each vertex.
        const angle = i * (2 * Math.PI / numPoints);
        // Use outer radius for even indices, inner radius for odd indices.
        const radius = (i % 2 === 0) ? outerRadius : innerRadius;
        fanVertices.push({ x: radius * Math.cos(angle), y: radius * Math.sin(angle) });
      }
      
      // Create the fan body near the center of the canvas.
      // We'll update its position each frame to follow the mouse.
      // Make it static so it doesn't fall.
      let fan = Bodies.fromVertices(canvas.width / 2, canvas.height / 2, fanVertices, {
        isStatic: true,
        render: { fillStyle: "#fff" }
      }, true);
      World.add(world, fan);
      
      // Set a slow angular speed for the fan.
      let fanRotation = 0;
      const fanAngularSpeed = 0.01;  // Slow rotation (radians per frame)
      
      // Fan will follow the mouse cursor.
      let fanPosition = { x: canvas.width / 2, y: canvas.height / 2 };
      window.addEventListener("mousemove", function(e) {
        fanPosition.x = e.clientX;
        fanPosition.y = e.clientY;
      });
      
      // --- Falling Letters ---
      // Helper functions.
      function randomLetter() {
        return String.fromCharCode(65 + Math.floor(Math.random() * 26));
      }
      function randomColor() {
        const colors = ["#ff0000", "#00ff00", "#0000ff", "#ffff00", "#ff00ff", "#00ffff", "#ffffff"];
        return colors[Math.floor(Math.random() * colors.length)];
      }
      // Spawn letters at random positions at the top.
      function spawnLetter() {
        const letter = randomLetter();
        const size = Common.random(30, 80);
        const x = Common.random(size / 2, canvas.width - size / 2);
        const y = -size;  // Start above the canvas.
        const letterBody = Bodies.rectangle(x, y, size, size, {
          restitution: 0.3,
          friction: 0.1,
          density: 0.001
        });
        Body.setAngle(letterBody, Common.random(-0.3, 0.3));
        letterBody.customData = { letter: letter, size: size, color: randomColor() };
        World.add(world, letterBody);
      }
      // Spawn a letter every 300 ms.
      setInterval(spawnLetter, 300);
      
      // --- Render Loop ---
      function render() {
        Engine.update(engine, 1000 / 60);
        
        // Update fan rotation and position.
        fanRotation += fanAngularSpeed;
        Body.setAngle(fan, fanRotation);
        // Update fan position to follow the mouse.
        Body.setPosition(fan, fanPosition);
        
        // Clear the canvas.
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        
        // Render each body.
        world.bodies.forEach(body => {
          // Render falling letters.
          if (body.customData && body.customData.letter) {
            ctx.save();
            ctx.translate(body.position.x, body.position.y);
            ctx.rotate(body.angle);
            ctx.font = body.customData.size + "px sans-serif";
            ctx.fillStyle = body.customData.color;
            ctx.textAlign = "center";
            ctx.textBaseline = "middle";
            ctx.fillText(body.customData.letter, 0, 0);
            ctx.restore();
          } else if (body === ground) {
            // Render the ground.
            ctx.fillStyle = "#888";
            ctx.beginPath();
            body.vertices.forEach((v, i) => {
              if (i === 0) ctx.moveTo(v.x, v.y);
              else ctx.lineTo(v.x, v.y);
            });
            ctx.closePath();
            ctx.fill();
          } else if (body === fan) {
            // Render the fan shape as a filled shape.
            ctx.fillStyle = "#fff";
            ctx.beginPath();
            body.vertices.forEach((v, i) => {
              if (i === 0) ctx.moveTo(v.x, v.y);
              else ctx.lineTo(v.x, v.y);
            });
            ctx.closePath();
            ctx.fill();
          }
        });
        
        requestAnimationFrame(render);
      }
      render();
    });
  </script>
</body>
</html>